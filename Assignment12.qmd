---
title: "Assignment 2"
layout: page
---

# Analysis by Downloading Google Trends Data


```{r, message=FALSE, warning=FALSE}
if (!requireNamespace("reshape2", quietly = TRUE)) {
  install.packages("reshape2")
}

library(ggplot2)
library(dplyr)
library(reshape2) 


website_data <- read.csv("google_trends_web.csv")

# Day to Date
website_data$Day <- as.Date(website_data$Day, format = "%m/%d/%Y")

# Reshape to long format 
website_long <- reshape2::melt(website_data, id.vars = "Day", 
                               variable.name = "Term", 
                               value.name = "Interest")

# Plot
ggplot(website_long, aes(x = Day, y = Interest, color = Term)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(
    title = "Google Trends: Search Interest (Website Download)",
    subtitle = "Daily search interest for Trump, Kamala Harris, and Election (Aug1 to Nov4 2024)",
    x = "Date",
    y = "Search Interest (0–100)"
  ) +
  scale_color_brewer(palette = "Set1") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

```
The provided code utilizes three CSV files obtained from Google Trends. However, the datasets require preprocessing due to inconsistencies and formatting issues unsuitable for direct R analysis. Data cleaning steps were thus essential to enable effective visualization.

# Analysis by gtrendsR

```{r}
if (!requireNamespace("gtrendsR", quietly = TRUE)) {
  install.packages("gtrendsR")
}
library(gtrendsR)


dates <- "2024-08-01 2024-11-04"
geo   <- "US"

# Configuration
dates <- "2024-08-01 2024-11-04"
geo   <- "US"
terms <- c("Trump", "Kamala Harris", "Election")
cache_file <- "data/google_trends_data.rds"  # ← Cache path

# Fetch or load cached data
if (!file.exists(cache_file)) {
  cat("Google Trends data not found. Fetching fresh data...\n")
  
  # SINGLE request with all terms (critical!)
  cat("Sending ONE request for:", paste(terms, collapse = ", "), "\n")
  Sys.sleep(2)  # Be polite
  
  trends_raw <- gtrends(
    keyword = terms,
    time = dates,
    geo = geo,
    gprop = "web",
    hl = "en-US"
  )
  
  # Extract interest over time
  trends_data <- trends_raw$interest_over_time
  
  # Ensure data directory exists
  dir.create("data", recursive = TRUE, showWarnings = FALSE)
  
  # Save to cache
  saveRDS(trends_data, file = cache_file)
  cat("data saved to", cache_file, "\n")
  
} else {
  cat("Loading cached Google Trends data from", cache_file, "\n")
  trends_data <- readRDS(cache_file)
}

# Clean keyword names (optional but tidy)
trends_data <- trends_data %>%
  mutate(
    keyword = case_when(
      keyword == "Trump" ~ "Donald.Trump",
      keyword == "Kamala Harris" ~ "Kamala.Harris",
      TRUE ~ keyword
    )
  )

# Plot
ggplot(trends_data, aes(x = date, y = hits, color = keyword)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(
    title = "Google Trends: Search Interest (gtrendsR Package)",
    subtitle = "Daily search interest for Trump, Kamala Harris, and Election (Aug 1 to Nov 4, 2024)",
    x = "Date",
    y = "Search Interest (0–100)"
  ) +
  scale_color_brewer(palette = "Set1") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

```
Using the gtrendsR package produces essentially the same substantive insights as downloading Google Trends data manually. The main distinction lies in workflow: gtrendsR automates the retrieval and returns data already structured for R, making the process smoother and reducing manual cleaning, while the underlying trend patterns remain unchanged.
